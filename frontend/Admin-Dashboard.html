<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #121212; color: #eee; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { padding: 10px; border: 1px solid #444; text-align: left; }
  th { background: #222; }
  button { padding: 6px 12px; margin-right: 6px; border: none; border-radius: 4px; cursor: pointer; }
  button.refund { background: #e63946; color: white; }
  button.edit { background: #f4a261; color: white; }
  #back-btn { background: #2a9d8f; color: white; margin-bottom: 20px; }
  #back-btn:hover { background: #21867a; }
  textarea { width: 100%; resize: vertical; }
</style>
</head>
<body>

<button id="back-btn">← Back to Main Page</button>

<h1>Donations Admin Dashboard</h1>

<table id="donations-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Amount</th>
      <th>Message</th>
      <th>Timestamp</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const backBtn = document.getElementById('back-btn');
  backBtn.addEventListener('click', () => {
    window.location.href = 'index.html';
  });

  // Replace with your API endpoint to fetch donations
  const API_ENDPOINT = '/api/get-donations';

  const tableBody = document.querySelector('#donations-table tbody');

  async function fetchDonations() {
    try {
      const res = await fetch(API_ENDPOINT);
      const donations = await res.json();

      tableBody.innerHTML = '';

      donations.forEach(donation => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${donation.id}</td>
          <td>${donation.name || 'anonymous'}</td>
          <td>£${donation.amount.toFixed(2)}</td>
          <td><textarea data-id="${donation.id}">${donation.message || ''}</textarea></td>
          <td>${new Date(donation.timestamp).toLocaleString()}</td>
          <td>
            <button class="refund" data-id="${donation.id}">Refund</button>
            <button class="edit" data-id="${donation.id}">Save</button>
          </td>
        `;

        tableBody.appendChild(tr);
      });

      // Attach event listeners for refund & save buttons
      document.querySelectorAll('.refund').forEach(btn => {
        btn.addEventListener('click', async e => {
          const id = e.target.dataset.id;
          if (confirm(`Refund donation ID ${id}?`)) {
            // Call your refund API here
            alert(`Refund API call for donation ${id} (not implemented)`);
          }
        });
      });

      document.querySelectorAll('.edit').forEach(btn => {
        btn.addEventListener('click', async e => {
          const id = e.target.dataset.id;
          const textarea = document.querySelector(`textarea[data-id="${id}"]`);
          const newMsg = textarea.value;

          // Call your API to update the message here
          alert(`Update message for donation ${id} to:\n"${newMsg}" (not implemented)`);
        });
      });

    } catch (error) {
      alert('Failed to load donations: ' + error.message);
    }
  }

  fetchDonations();
</script>

</body>
</html>
